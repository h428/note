
# 4. 面向切面的 Spring

---

- 本章主要内容：
    - 面向切面编程的基本原理
    - 通过 POJO 创建切面
    - 使用 `@AspectJ` 注解
    - 为 AspectJ 切面注入依赖


## 4.1 什么是面向切面编程

- 面向切面编程可用于模块化横切关注点，可以定义通用的横切关注点，然后织入到指定的地方即可
- 切面提供了取代继承和委托的另一种服用方式，且在复用通用功能时特别合适，如事务控制、安全管理等

### 4.1.1 AOP 术语

- 主要的相关术语包括：通知、连接点、切点、切面、引入、织入等

**通知**

- 通知描述了切面要完成的工作，并定义了何时调用：
- Spring 切面可以应用 5 种通知类型：Before, After, After-returning, After-throwing, Around
- 通知相当于定义了“什么”和“何时”

**连接点**

- 连接点是一个**抽象概念**，其定义为通知织入的时机
- 这个时机可以是调用方法时、抛出异常时、修改字段时等

**切点**

- 连接点是抽象的概念，切点即具体的被织入的地方
- 切点相当于定义了“何处”

**切面**

- 切面可以看成通知和切点的综合
- 一个切面可以包含多个切点和对应的通知

**引入**

- 引入可以向现有类添加新方法和属性而不需改变原有类

**织入**

- 切面在指定的连接点织入到目标对象中，在目标对象的生命周期里有多个点可以进行织入：
- 编译期：切面在目标类编译时被织入，这种方式需要特殊的编译器，AspectJ 的织入编译器就是以这种方式织入切面的
- 类加载器：切面在目标类加载到 JVM 时被织入，这种方式需要特殊的类加载器，它可以在目标类被引入应用之前增强该目标类的字节码，AspectJ 5 的加载时织入就支持以该种方式织入
- 运行时：在应用运行的某个时刻织入通知，一般通过动态代理进行织入，Spring AOP 就是基于这种方式织入的

### 4.1.2 Spring 对 AOP 的支持

- Spring 提供了 4 种类型的 AOP 支持：
    - 基于代理的经典 Spring AOP
    - 纯 POJO 切面
    - `@AspectJ` 注解驱动的切面
    - 注入式 AspectJ 切面（适用于 Spring 各版本）
- 使用 XML 方式时，可以借助 Spring 的 aop 命名空间，可以将 POJO 转换为切面
- 也可以使用基于注解驱动的 AOP，其是基于代理的 AOP，切点必须基于方法





