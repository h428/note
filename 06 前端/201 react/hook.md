
# 1. Hook ç®€ä»‹

- Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§
- React 16.8.0 æ˜¯ç¬¬ä¸€ä¸ªæ”¯æŒ Hook çš„ç‰ˆæœ¬ã€‚å‡çº§æ—¶ï¼Œè¯·æ³¨æ„æ›´æ–°æ‰€æœ‰çš„ packageï¼ŒåŒ…æ‹¬ React DOMã€‚ React Native ä» 0.59 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ Hook
- Hook æ˜¯ä¸€äº›å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶é‡Œâ€œé’©å…¥â€ React state åŠç”Ÿå‘½å‘¨æœŸç­‰ç‰¹æ€§çš„å‡½æ•°ï¼Œä½¿å¾—ä½ ä¸ä½¿ç”¨ class ä¹Ÿèƒ½ä½¿ç”¨ React
- Hook çš„ä½œç”¨ :
    - Hook ä½¿ä½ åœ¨æ— éœ€ä¿®æ”¹ç»„ä»¶ç»“æ„çš„æƒ…å†µä¸‹å¤ç”¨çŠ¶æ€é€»è¾‘ï¼Œè¿™ä½¿å¾—åœ¨ç»„ä»¶é—´æˆ–ç¤¾åŒºå†…å…±äº« Hook å˜å¾—æ›´ä¾¿æ·
    - Hook å°†ç»„ä»¶ä¸­ç›¸äº’å…³è”çš„éƒ¨åˆ†æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ï¼ˆæ¯”å¦‚è®¾ç½®è®¢é˜…æˆ–è¯·æ±‚æ•°æ®ï¼‰ï¼Œè€Œå¹¶éå¼ºåˆ¶æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†
    - Hook ä½¿ä½ åœ¨é class çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨æ›´å¤šçš„ React ç‰¹æ€§

# 2. Hook æ¦‚è§ˆ

## 2.1 useState

- useState æ˜¯æˆ‘ä»¬è¦å­¦ä¹ çš„ç¬¬ä¸€ä¸ª â€œHookâ€ï¼Œé€šè¿‡åœ¨å‡½æ•°ç»„ä»¶é‡Œè°ƒç”¨å®ƒæ¥ç»™ç»„ä»¶æ·»åŠ ä¸€äº›å†…éƒ¨ state
- useState ä¼šè¿”å›ä¸€å¯¹å€¼ï¼šå½“å‰çŠ¶æ€å’Œä¸€ä¸ªè®©ä½ æ›´æ–°å®ƒçš„å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æˆ–å…¶ä»–ä¸€äº›åœ°æ–¹è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç±»ä¼¼ setState
- useState å”¯ä¸€çš„å‚æ•°å°±æ˜¯åˆå§‹ state çš„å€¼ï¼Œè¿™ä¸ªåˆå§‹ state å‚æ•°åªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ä¼šè¢«ç”¨åˆ°ï¼Œè€Œä¸”ä¸åŒäºåŸæœ‰çš„ this.stateï¼Œè¿™é‡Œçš„ state ä¸ä¸€å®šè¦æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥æ˜¯æ™®é€šçº¸
- ä¾‹å¦‚ä¸‹è¿°ä¾‹å­ï¼Œä½¿ç”¨ useState è¿”å›äº† count å˜é‡ä»¥åŠä¿®æ”¹å®ƒçš„ setCount å‡½æ•° :
- 
```jsx
import React, { useState } from 'react';

function Example() {
  // å£°æ˜ä¸€ä¸ªå« â€œcountâ€ çš„ state å˜é‡ã€‚
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```
- å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å¤šæ¬¡ä½¿ç”¨ State Hook æ¥å£°æ˜å¤šä¸ª state å˜é‡ï¼Œä¾‹å¦‚ä¸‹è¿°ä¾‹å­ :
```jsx
function ExampleWithManyStates() {
  // å£°æ˜å¤šä¸ª state å˜é‡ï¼
  const [age, setAge] = useState(42);
  const [fruit, setFruit] = useState('banana');
  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }]);
  // ...
}
```

## 2.2 useEffect

- useEffect å°±æ˜¯ä¸€ä¸ª Effect Hookï¼Œç»™å‡½æ•°ç»„ä»¶å¢åŠ äº†æ“ä½œå‰¯ä½œç”¨çš„èƒ½åŠ›ï¼Œå®ƒè·Ÿ class ç»„ä»¶ä¸­çš„ componentDidMountã€componentDidUpdate å’Œ componentWillUnmount å…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œåªä¸è¿‡è¢«åˆå¹¶æˆäº†ä¸€ä¸ª API
- ç›´è§‚ç†è§£ï¼šstate ä¸­æ•°æ®å‘ç”Ÿå˜åŒ–å¹¶åœ¨ç»„ä»¶ render å®Œæ¯•ä¹‹åçš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå›è°ƒ
- å½“ä½ è°ƒç”¨ useEffect æ—¶ï¼Œå°±æ˜¯åœ¨å‘Šè¯‰ React åœ¨å®Œæˆå¯¹ DOM çš„æ›´æ”¹åè¿è¡Œä½ çš„â€œå‰¯ä½œç”¨â€å‡½æ•°ã€‚ç”±äºå‰¯ä½œç”¨å‡½æ•°æ˜¯åœ¨ç»„ä»¶å†…å£°æ˜çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥è®¿é—®åˆ°ç»„ä»¶çš„ props å’Œ state
- é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè°ƒç”¨å‰¯ä½œç”¨å‡½æ•° â€”â€” åŒ…æ‹¬ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šåœ¨ä½¿ç”¨ Effect Hook ä¸­è·Ÿ class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åšæ›´è¯¦ç»†çš„å¯¹æ¯”
- ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªç»„ä»¶åœ¨ React æ›´æ–° DOM åä¼šè®¾ç½®ä¸€ä¸ªé¡µé¢ title :
```jsx
import React, { useState, useEffect } from 'react';

function Example() {
  const [count, setCount] = useState(0);

  // ç›¸å½“äº componentDidMount å’Œ componentDidUpdate:
  useEffect(() => {
    // ä½¿ç”¨æµè§ˆå™¨çš„ API æ›´æ–°é¡µé¢æ ‡é¢˜
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```
- setCount å’Œ setState ç±»ä¼¼ï¼Œé™¤äº†ç›´æ¥ä½¿ç”¨å€¼å¤–ï¼Œä¹Ÿå¯ä»¥æ”¹ä¸ºæ›´æ–°å‡½æ•°çš„å½¢å¼ï¼Œä¾‹å¦‚ï¼š
```jsx
<button onClick={() => setCount(prevCount => prevCount + 1)}>
  Click me
</button>
```
- æ­¤å¤–ï¼Œå‰¯ä½œç”¨å‡½æ•°è¿˜å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ªå‡½æ•°æ¥æŒ‡å®šå¦‚ä½•â€œæ¸…é™¤â€å‰¯ä½œç”¨ï¼Œåœ¨ class ç»„ä»¶ä¸­é€šå¸¸é€šè¿‡ componentWillUnmount å®ç° :
```jsx
import React, { useState, useEffect } from 'react';

function FriendStatus(props) {
  const [isOnline, setIsOnline] = useState(null);

  function handleStatusChange(status) {
    setIsOnline(status.isOnline);
  }

  useEffect(() => {
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);

    // æ¸…é™¤å‰¯ä½œç”¨
    return () => {
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    };
  });

  if (isOnline === null) {
    return 'Loading...';
  }
  return isOnline ? 'Online' : 'Offline';
}
```
- éœ€è¦æ³¨æ„ï¼Œæ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°å¿…å®šä¼šåœ¨æœ¬æ¬¡ render é”€æ¯ä¹‹åæ‰§è¡Œä¸€æ¬¡ï¼Œä½†ä¸ä¸€å®šæ˜¯åœ¨ä¸‹æ¬¡ render ä¹‹å‰æ‰§è¡Œï¼Œä¾‹å¦‚ä¸‹è¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œreact å…ˆæ‰§è¡Œäº†ä¸‹ä¸€æ¬¡çš„ render åï¼Œæ‰è°ƒç”¨äº†æœ¬æ¬¡çš„æ¸…æ¥šå‰¯ä½œç”¨å‡½æ•°
```jsx
import React, {useState, useEffect} from 'react';

export default () => {
    const [count, setCount] = useState(0);

    useEffect(() => {
        // ç›¸å½“äº state å‘ç”Ÿå˜åŒ–åçš„å›è°ƒ
        document.title = `ä½ ç‚¹å‡»äº† ${count} æ¬¡`;
        console.log(`did update : ${count}`);

        /**
         * useEffect å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œç›¸å½“äº componentWillUnmount
         * è§¦å‘è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨æœ¬æ¬¡ render é”€æ¯ä¸‹ä¸€æ¬¡ render å¼€å§‹ä¹‹å‰ï¼Œä½†çœŸæ­£è°ƒç”¨ä¸ä¸€å®šåœ¨ä¸‹ä¸€ render ä¹‹å‰ï¼Œ
         * è§¦å‘é”€æ¯æ—¶é—´åï¼Œè¯¥å›è°ƒå¿…å®šä¼šè¢«è°ƒç”¨ï¼Œä½†å¯èƒ½æ˜¯åœ¨ä¸‹ä¸€æ¬¡ render æ¸²æŸ“å®Œæˆåæ‰è°ƒç”¨ï¼ˆReact ä¼šä¼˜å…ˆåšä¸‹ä¸€æ¬¡ renderï¼‰
         * ä½†é‡Œé¢æ‹¿åˆ°çš„ state å€¼è‚¯å®šæ˜¯ä¸‹ä¸€æ¬¡ render ä¹‹å‰çš„åŸæ¥çš„å€¼ï¼Œè¿™ç‚¹ä¸ç”¨æ‹…å¿ƒ
         * å› æ­¤ï¼Œæˆ‘ä»¬æ¯æ¬¡å•å‡»å¹¶åœ¨æ§åˆ¶å°è§‚å¯Ÿæ‰“å°ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¡ºåºï¼ˆå‡è®¾ count ç”± 2 -> 3ï¼‰ï¼š
         *      render code : 3 ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼Œåº”è¯¥å¯èƒ½å¤šæ¬¡è§¦å‘æ¸²æŸ“ä¹‹ç±»çš„ï¼‰
         *      before destroy : 2 ï¼ˆå‰¯ä½œç”¨çš„è°ƒç”¨æ˜¯åœ¨ä¸‹æ¬¡æ¸²æŸ“ä¹‹åè°ƒç”¨ï¼Œå› æ­¤ä¸èƒ½ä¾èµ–æ¸²æŸ“ä¹‹å‰çš„æ—¶æœºï¼‰
         *      did update : 3
         */
        return () => {
            // åœ¨ä¸‹ä¸€æ¬¡ render ä¹‹åæ‰§è¡Œï¼Œä½†æ‹¿åˆ°çš„ count ä»ç„¶æ˜¯æœ¬æ¬¡è¦é”€æ¯çš„ count å€¼
            console.log('before destroy : ', count);
        }
    });

    console.log('render code : ', count);

    return (
        <div>
            <p>ä½ ç‚¹å‡»äº† {count} æ¬¡</p>
            <button onClick={() => setCount(count + 1)}>
                ç‚¹å‡»
            </button>
        </div>
    );
}
```
- è·Ÿ useState ä¸€æ ·ï¼Œä½ å¯ä»¥åœ¨ç»„ä»¶ä¸­å¤šæ¬¡ä½¿ç”¨ useEffect
- é€šè¿‡ä½¿ç”¨ Hookï¼Œä½ å¯ä»¥æŠŠç»„ä»¶å†…ç›¸å…³çš„å‰¯ä½œç”¨ç»„ç»‡åœ¨ä¸€èµ·ï¼ˆä¾‹å¦‚åˆ›å»ºè®¢é˜…åŠå–æ¶ˆè®¢é˜…ï¼‰ï¼Œè€Œä¸è¦æŠŠå®ƒä»¬æ‹†åˆ†åˆ°ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°é‡Œ

## 2.3 Hook ä½¿ç”¨è§„åˆ™

- Hook å°±æ˜¯ JavaScript å‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒä»¬ä¼šæœ‰ä¸¤ä¸ªé¢å¤–çš„è§„åˆ™
- åªèƒ½åœ¨å‡½æ•°æœ€å¤–å±‚è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…å­å‡½æ•°ä¸­è°ƒç”¨
- åªèƒ½åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å…¶ä»– JavaScript å‡½æ•°ä¸­è°ƒç”¨
- è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹å¯ä»¥è°ƒç”¨ Hook â€”â€” å°±æ˜¯è‡ªå®šä¹‰çš„ Hook ä¸­ï¼Œæˆ‘ä»¬ç¨åä¼šå­¦ä¹ åˆ°

## 2.4 è‡ªå®šä¹‰ Hook

- æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæƒ³è¦åœ¨ç»„ä»¶ä¹‹é—´é‡ç”¨ä¸€äº›çŠ¶æ€é€»è¾‘ã€‚ç›®å‰ä¸ºæ­¢ï¼Œæœ‰ä¸¤ç§ä¸»æµæ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šé«˜é˜¶ç»„ä»¶å’Œ render props
- è‡ªå®šä¹‰ Hook å¯ä»¥è®©ä½ åœ¨ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è¾¾åˆ°åŒæ ·çš„ç›®çš„
- ä½¿ç”¨å‚è€ƒå®˜æ–¹æ–‡æ¡£


# 3. ä½¿ç”¨ State Hook

- ç®€å•çš„è¯´ï¼ŒuseState è®©ä½ èƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ this.stateï¼Œä»¥å‰ this.state åªèƒ½åœ¨ class ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œè€Œé€šè¿‡ä½¿ç”¨ Hookï¼Œè®©å‡½æ•°ç»„ä»¶å…·å¤‡äº†ç±»ç»„ä»¶çš„ state
- Hook æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒå¯ä»¥è®©ä½ â€œé’©å…¥â€ React çš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼ŒuseState æ˜¯å…è®¸ä½ åœ¨ React å‡½æ•°ç»„ä»¶ä¸­æ·»åŠ  state çš„ Hook
- å¦‚æœä½ åœ¨ç¼–å†™å‡½æ•°ç»„ä»¶å¹¶æ„è¯†åˆ°éœ€è¦å‘å…¶æ·»åŠ ä¸€äº› stateï¼Œä»¥å‰çš„åšæ³•æ˜¯å¿…é¡»å°†å…¶å®ƒè½¬åŒ–ä¸º classã€‚ç°åœ¨ä½ å¯ä»¥åœ¨ç°æœ‰çš„å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ Hook
- å‰é¢çš„ä¾‹å­ :
```jsx
import React, { useState } from 'react';

function Example() {
  // å£°æ˜ä¸€ä¸ªå« "count" çš„ state å˜é‡
  const [count, setCount] = useState(0);

  return (
    ...
  );
}
```
- useState æ˜¯ä¸€ç§æ–°æ–¹æ³•ï¼Œå®ƒä¸ class é‡Œé¢çš„ this.state æä¾›çš„åŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å‡½æ•°é€€å‡ºåå˜é‡å°±ä¼šâ€æ¶ˆå¤±â€ï¼Œè€Œ state ä¸­çš„å˜é‡ä¼šè¢« React ä¿ç•™
- æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå« count çš„ state å˜é‡ï¼Œç„¶åæŠŠå®ƒè®¾ä¸º 0ï¼ŒReact ä¼šåœ¨é‡å¤æ¸²æŸ“æ—¶è®°ä½å®ƒå½“å‰çš„å€¼ï¼Œå¹¶ä¸”æä¾›æœ€æ–°çš„å€¼ç»™æˆ‘ä»¬çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ setCount æ¥æ›´æ–°å½“å‰çš„ count

# 4. ä½¿ç”¨ Effect Hook 

- ç®€å•åœ°è¯´ï¼ŒEffect Hook å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œï¼Œä»¥å‰åªèƒ½é€šè¿‡ class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å®ç°
- å¦‚æœä½ ç†Ÿæ‚‰ React class çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä½ å¯ä»¥æŠŠ useEffect Hook çœ‹åš componentDidMountï¼ŒcomponentDidUpdate å’Œ componentWillUnmount è¿™ä¸‰ä¸ªå‡½æ•°çš„ç»„åˆ
- åœ¨ React ç»„ä»¶ä¸­æœ‰ä¸¤ç§å¸¸è§å‰¯ä½œç”¨æ“ä½œï¼šéœ€è¦æ¸…é™¤çš„å’Œä¸éœ€è¦æ¸…é™¤çš„ï¼Œæˆ‘ä»¬æ¥æ›´ä»”ç»†åœ°çœ‹ä¸€ä¸‹ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«

## 4.1 æ— éœ€æ¸…é™¤çš„ effect

- æœ‰æ—¶æˆ‘ä»¬åªæƒ³åœ¨ React æ›´æ–° DOM ä¹‹åé¢å¤–è¿è¡Œä¸€äº›ä»£ç ï¼Œæ¯”å¦‚å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œ
- åœ¨ä¼ ç»Ÿçš„ class ç»„ä»¶ä¸­ï¼Œä¸€èˆ¬é€šè¿‡ componentDidMount å’Œ componentDidUpdate ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°è¾¾åˆ°ä¸Šè¿°ç›®çš„
- ä½¿ç”¨ Hook åï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ä¸å¸¦è¿”å›å€¼çš„ useEffect å³å¯
- useEffect æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å³ä¸ºé‡æ–° render åéœ€è¦æ‰§è¡Œçš„é¢å¤–æ“ä½œï¼Œå¦‚æœéœ€è¦æ¸…é™¤ effectï¼Œåˆ™åªè¦åœ¨è¯¥å‡½æ•°å†…è¿”å›ä¸€ä¸ªæ¸…é™¤ effect çš„å‡½æ•°å³å¯
- useEffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œï¼ˆåŒ…æ‹¬ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œï¼‰ï¼Œä¸ç”¨å†å»è€ƒè™‘â€œæŒ‚è½½â€è¿˜æ˜¯â€œæ›´æ–°â€ï¼ŒReact ä¿è¯äº†æ¯æ¬¡è¿è¡Œ effect çš„åŒæ—¶ï¼ŒDOM éƒ½å·²ç»æ›´æ–°å®Œæ¯•
- ä¸ componentDidMount æˆ– componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«
- å‰é¢å·²ç»ç»™è¿‡ä¸€ä¸ªæ— éœ€æ¸…é™¤çš„ effect ç¤ºä¾‹ï¼Œä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œå†æ¬¡æä¾›è¯¥ç¤ºä¾‹ï¼š
```jsx
import React, {useState, useEffect} from 'react';

export default () => {
    const [count, setCount] = useState(0);

    useEffect(() => {
        // ç›¸å½“äº state å‘ç”Ÿå˜åŒ–åçš„å›è°ƒ
        document.title = `ä½ ç‚¹å‡»äº† ${count} æ¬¡`;
        console.log(`did update : ${count}`);

        // æ— éœ€æ¸…é™¤çš„ effectï¼Œæ²¡æœ‰è¿”å›å€¼
    });

    console.log('render code : ', count);

    return (
        <div>
            <p>ä½ ç‚¹å‡»äº† {count} æ¬¡</p>
            <button onClick={() => setCount(count + 1)}>
                ç‚¹å‡»
            </button>
        </div>
    );
}
```

## 4.2 éœ€è¦æ¸…é™¤çš„ effect

- è¿˜æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ï¼Œä¾‹å¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²
- åœ¨ä¼ ç»Ÿçš„ class ç»„ä»¶ä¸­ï¼Œæ¸…é™¤å·¥ä½œé€šå¸¸åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•° componentWillUnmount ä¸­ç¼–å†™
- useEffect å°†å‰¯ä½œç”¨å’Œæ¸…é™¤å·¥ä½œç´§å¯†åœ°è”ç³»èµ·æ¥ï¼Œä½ åªéœ€åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ï¼ŒReact å°†ä¼šåœ¨æ‰§è¡Œæ¸…é™¤æ“ä½œæ—¶è°ƒç”¨å®ƒ
- åœ¨ effect ä¸­å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ï¼Œä¾‹å¦‚å¯ä»¥å°†æ·»åŠ å’Œç§»é™¤è®¢é˜…çš„é€»è¾‘æ”¾åœ¨ä¸€èµ·ï¼Œä»–ä»¬éƒ½å±äº effect çš„ä¸€éƒ¨åˆ†
- React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œ
- ä½¿ç”¨ Hook å…¶ä¸­ä¸€ä¸ªç›®çš„å°±æ˜¯è¦è§£å†³ class ä¸­ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç»å¸¸åŒ…å«ä¸ç›¸å…³çš„é€»è¾‘ï¼Œä½†åˆæŠŠç›¸å…³é€»è¾‘åˆ†ç¦»åˆ°äº†å‡ ä¸ªä¸åŒæ–¹æ³•ä¸­çš„é—®é¢˜
- è¿˜æ˜¯ä½¿ç”¨å‰é¢çš„ä¾‹å­ï¼Œä¸è¿‡è¿™æ¬¡æˆ‘ä»¬åœ¨ effect ä¸­ç»™å‡ºè¿”å›å€¼ï¼Œç”¨äºæ¸…é™¤å‰¯ä½œç”¨ï¼Œå…¶ä½œç”¨ç›¸å½“äº componentWillUnmount
```jsx
import React, {useState, useEffect} from 'react';

export default () => {
    const [count, setCount] = useState(0);

    useEffect(() => {
        // ç›¸å½“äº state å‘ç”Ÿå˜åŒ–åçš„å›è°ƒ
        document.title = `ä½ ç‚¹å‡»äº† ${count} æ¬¡`;
        console.log(`did update : ${count}`);

        // è¿”å›ä¸€ä¸ªæ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œç›¸å½“äº componentWillUnmount
        return () => {
            // å®é™…ä¸Šæ˜¯åœ¨ä¸‹ä¸€æ¬¡ render ä¹‹åæ‰§è¡Œï¼Œä½†æ‹¿åˆ°çš„ count ä»ç„¶æ˜¯æœ¬æ¬¡è¦é”€æ¯çš„ count å€¼
            console.log('before destroy : ', count);
        }
    });

    console.log('render code : ', count);

    return (
        <div>
            <p>ä½ ç‚¹å‡»äº† {count} æ¬¡</p>
            <button onClick={() => setCount(count + 1)}>
                ç‚¹å‡»
            </button>
        </div>
    );
}
```

## 4.3 effect è¡¥å……

- useEffectï¼šstate å˜åŒ– -> ç»„ä»¶æ¸²æŸ“ -> è°ƒç”¨ effect
- å¦‚æœè¿˜éœ€è¦æ¸…é™¤å‰¯ä½œç”¨ï¼ˆç›¸å½“äº componentWillUnmountï¼‰ï¼Œåˆ™éœ€è¦åœ¨ effect ä¸­è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ï¼Œè‹¥ä¸éœ€æ¸…é™¤åˆ™ä¸å¿…è¿”å›
- useEffect å’Œä¼ ç»Ÿçš„ç±»ç»„ä»¶çš„ componentDidMountã€componentDidUpdateã€componentWillUnmount ç›¸æ¯”ï¼Œå…¶ä¼˜åŠ¿åœ¨äºå¯ä»¥å°†åŒä¸€ä¸ªå…³æ³¨ç‚¹æ•´åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä½¿ç”¨å¤šä¸ª useEffect åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œè‹¥ä½¿ç”¨ä¼ ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä¼šä½¿å¾—å„ä¸ªå…³æ³¨ç‚¹çš„æ›´æ–°å’Œæ¸…é™¤ä»£ç åˆ†åˆ«å­˜åœ¨äºä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ï¼Œç»´æŠ¤å›°éš¾
- React å°†æŒ‰ç…§ effect å£°æ˜çš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„æ¯ä¸€ä¸ª effect

**è§£é‡Š: ä¸ºä»€ä¹ˆæ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ Effect**

- class ç»„ä»¶çš„ componentWillUnmount åªä¼šåœ¨ç»„ä»¶è¦é”€æ¯æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œè€Œ effect ä¸­çš„æ¸…é™¤å‡½æ•°ä¼šåœ¨æ¯æ¬¡æ›´æ–°å€¼éƒ½ä¼šæ‰§è¡Œï¼Œç›¸å½“äºå¤šæ¬¡ componentWillUnmount
- ä½ æˆ–è®¸ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆ effect çš„æ¸…é™¤é˜¶æ®µåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šæ‰§è¡Œï¼Œè€Œä¸æ˜¯åªåœ¨å¸è½½ç»„ä»¶çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡
- è¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘ bugï¼Œå› ä¸ºåœ¨ç±»ç»„ä»¶ä¸­å¿˜è®°æ­£ç¡®åœ°å¤„ç† componentDidUpdate æ˜¯ React åº”ç”¨ä¸­å¸¸è§çš„ bug æ¥æºï¼ˆæˆ‘ä»¬ç»å¸¸åªç¼–å†™äº† componentDidMount å´å¿˜äº†ç¼–å†™ componentDidUpdateï¼Œè€Œä¸”è¿™ä¸¤ä¸ªå‡½æ•°çš„é€»è¾‘å¾€å¾€æ˜¯ä¸€æ ·çš„ï¼‰
- è‹¥æ˜¯ä½¿ç”¨ hookï¼Œåˆ™ä¸ä¼šå—åˆ°è¿™ç§ bug å½±å“ï¼Œhook ä¸éœ€è¦ç‰¹å®šçš„ä»£ç æ¥å¤„ç†æ›´æ–°é€»è¾‘ï¼Œå› ä¸º useEffect é»˜è®¤å°±ä¼šå¤„ç†ï¼Œå®ƒä¼šåœ¨è°ƒç”¨ä¸€ä¸ªæ–°çš„ effect ä¹‹å‰å¯¹å‰ä¸€ä¸ª effect è¿›è¡Œæ¸…ç†
- å…·ä½“çš„ä¾‹å­å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œæ­¤å¤„ä¸ºç®€å•æè¿°ï¼š
```jsx
// Mount with { friend: { id: 100 } } props
ChatAPI.subscribeToFriendStatus(100, handleStatusChange);     // è¿è¡Œç¬¬ä¸€ä¸ª effect

// Update with { friend: { id: 200 } } props
ChatAPI.unsubscribeFromFriendStatus(100, handleStatusChange); // æ¸…é™¤ä¸Šä¸€ä¸ª effect
ChatAPI.subscribeToFriendStatus(200, handleStatusChange);     // è¿è¡Œä¸‹ä¸€ä¸ª effect

// Update with { friend: { id: 300 } } props
ChatAPI.unsubscribeFromFriendStatus(200, handleStatusChange); // æ¸…é™¤ä¸Šä¸€ä¸ª effect
ChatAPI.subscribeToFriendStatus(300, handleStatusChange);     // è¿è¡Œä¸‹ä¸€ä¸ª effect

// Unmount
ChatAPI.unsubscribeFromFriendStatus(300, handleStatusChange); // æ¸…é™¤æœ€åä¸€ä¸ª effect
```
- æ­¤é»˜è®¤è¡Œä¸ºä¿è¯äº†ä¸€è‡´æ€§ï¼Œé¿å…äº†åœ¨ class ç»„ä»¶ä¸­å› ä¸ºæ²¡æœ‰å¤„ç†æ›´æ–°é€»è¾‘è€Œå¯¼è‡´å¸¸è§çš„ bug

**æç¤º: é€šè¿‡è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–**

- æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œæ¯æ¬¡è°ƒç”¨ effect å‰éƒ½ä¼šå¯¹å‰ä¸€æ¬¡çš„ effect è¿›è¡Œæ¸…ç†
- ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œæ¸…ç†æˆ–è€…æ‰§è¡Œ effect å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜
- åœ¨ class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ componentDidUpdate ä¸­æ·»åŠ å¯¹ prevProps æˆ– prevState çš„æ¯”è¾ƒé€»è¾‘è§£å†³ï¼š
```jsx
componentDidUpdate(prevProps, prevState) {
  if (prevState.count !== this.state.count) {
    document.title = `You clicked ${this.state.count} times`;
  }
}
```
- ä¸Šè¿°æƒ…å†µæ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œæ‰€ä»¥å®ƒè¢«å†…ç½®åˆ° useEffect çš„ Hook API ä¸­ï¼Œå¦‚æœç‰¹å®šå€¼åœ¨ä¸¤æ¬¡é‡æ–°æ¸²æŸ“ä¹‹é—´æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥è®© React è·³è¿‡å¯¹ effect çš„è°ƒç”¨ï¼Œè¿™æ ·å°±é¿å…äº†é‡å¤æ¸²æŸ“
```jsx
useEffect(() => {
  document.title = `You clicked ${count} times`;
}, [count]); // ä»…åœ¨ count æ›´æ”¹æ—¶æ›´æ–°
```
- ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥ [count] ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ
- å¦‚æœ count çš„å€¼æ˜¯ 5ï¼Œè€Œä¸”æˆ‘ä»¬çš„ç»„ä»¶é‡æ¸²æŸ“çš„æ—¶å€™ count è¿˜æ˜¯ç­‰äº 5ï¼ŒReact å°†å¯¹å‰ä¸€æ¬¡æ¸²æŸ“çš„ `[5]` å’Œåä¸€æ¬¡æ¸²æŸ“çš„ `[5]` è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ç›¸ç­‰çš„(5 === 5)ï¼ŒReact ä¼šè·³è¿‡è¿™ä¸ª effectï¼Œè¿™å°±å®ç°äº†æ€§èƒ½çš„ä¼˜åŒ–
- å½“æ¸²æŸ“æ—¶ï¼Œå¦‚æœ count çš„å€¼æ›´æ–°æˆäº† 6ï¼ŒReact å°†ä¼šæŠŠå‰ä¸€æ¬¡æ¸²æŸ“æ—¶çš„æ•°ç»„ `[5]` å’Œè¿™æ¬¡æ¸²æŸ“çš„æ•°ç»„ `[6]` ä¸­çš„å…ƒç´ è¿›è¡Œå¯¹æ¯”ã€‚è¿™æ¬¡å› ä¸º 5 !== 6ï¼ŒReact å°±ä¼šå†æ¬¡è°ƒç”¨ effect
- ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœæ•°ç»„ä¸­æœ‰å¤šä¸ªå…ƒç´ ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªå…ƒç´ å‘ç”Ÿå˜åŒ–ï¼ŒReact ä¹Ÿä¼šæ‰§è¡Œ effect
- ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œcount1ã€count2 å€¼å‘ç”Ÿå˜åŒ–æ—¶éƒ½ä¼šå¯¼è‡´æ¸²æŸ“ï¼Œä½†åªæœ‰ count1 å€¼å˜åŒ–æ—¶æ‰ä¼šè°ƒç”¨å®šä¹‰çš„ effect
```jsx
import React, {useState, useEffect} from 'react';

export default () => {
    const [count1, setCount1] = useState(0);
    const [count2, setCount2] = useState(0);

    // count1, count2 å…¶ä¸­çš„ä¸€ä¸ªå‘ç”Ÿå˜åŒ–åï¼Œéƒ½ä¼šå¯¼è‡´é‡æ–° render
    // ä½†åªæœ‰ count1 çš„å€¼å‘ç”Ÿå˜åŒ–åï¼Œæ‰ä¼šè§¦å‘ effect çš„ä¸Šä¸€æ¬¡æ¸…é™¤ä»¥åŠæœ¬æ¬¡çš„è°ƒç”¨
    useEffect(() => {
        // ç›¸å½“äº state å‘ç”Ÿå˜åŒ–åçš„å›è°ƒ
        document.title = `ä½ ç‚¹å‡»äº† ${count1} æ¬¡ count1, ${count2} æ¬¡ count2`;
        console.log(`did update : ${count1}, ${count2}`);

        // è¿”å›ä¸€ä¸ªæ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œç›¸å½“äº componentWillUnmount
        return () => {
            // éœ€è¦ç‰¹åˆ«æ³¨æ„è¿™é‡Œæ‹¿åˆ°çš„æ˜¯ä¸Šä¸€æ¬¡ effect è°ƒç”¨æ—¶çš„å€¼ï¼Œå› æ­¤ count2 å¯èƒ½ä¸è¿ç»­
            // å› ä¸ºå•å‡» count ä¸ä¼šå¯¼è‡´ effect çš„è°ƒç”¨ï¼Œåªæœ‰çš„ä¸‹æ¬¡å•å‡» count1 æ—¶ï¼Œ
            // count2 çš„å€¼ä¼šä»ä¸Šä¸€æ¬¡å•å‡» count1 æ—¶çš„é”€æ¯æ—¶çš„å€¼å˜ä¸ºè¯¥æ¬¡å•å‡» count2 æ—¶çš„é”€æ¯æ—¶çš„å€¼
            console.log('before destroy : ', count1, count2);
        }
    }, [count1]); // è®¾ç½®åªæœ‰ count1 å‘ç”Ÿå˜åŒ–æ‰ä¼šè§¦å‘ effect å›è°ƒ


    return (
        <div>
            <p>ä½ ç‚¹å‡»äº† {count1} æ¬¡ count1</p>
            <p>ä½ ç‚¹å‡»äº† {count2} æ¬¡ count2</p>
            <button onClick={() => setCount1(count1 + 1)}>
                count1
            </button> &nbsp;
            <button onClick={() => setCount2(count2 + 1)}>
                count2
            </button>
        </div>
    );
}
```


# 5. Hook è§„åˆ™

- Hook æœ¬è´¨å°±æ˜¯ JavaScript å‡½æ•°ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å®ƒæ—¶éœ€è¦éµå¾ªä¸¤æ¡è§„åˆ™
- åªåœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨åœ°æœ€é¡¶å±‚ä½¿ç”¨ Hookï¼Œä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookï¼Œ ç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„ React å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨ä»–ä»¬
- éµå®ˆå‰é¢è¿™æ¡è§„åˆ™ï¼Œä½ å°±èƒ½ç¡®ä¿ Hook åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½æŒ‰ç…§åŒæ ·çš„é¡ºåºè¢«è°ƒç”¨ã€‚è¿™è®© React èƒ½å¤Ÿåœ¨å¤šæ¬¡çš„ useState å’Œ useEffect è°ƒç”¨ä¹‹é—´ä¿æŒ hook çŠ¶æ€çš„æ­£ç¡®
- åªåœ¨ React å‡½æ•°æˆ–è€…è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨ Hookï¼Œä¸è¦åœ¨æ™®é€šçš„ JavaScript å‡½æ•°ä¸­è°ƒç”¨ Hook
- å¦‚æœåœ¨ if else ä¸­è°ƒç”¨ Hookï¼Œå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶ Hook çš„è°ƒç”¨é¡ºåºå‘ç”Ÿå˜åŒ–ï¼Œä»è€Œäº§ç”Ÿ bug
- è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Hook éœ€è¦åœ¨æˆ‘ä»¬ç»„ä»¶çš„æœ€é¡¶å±‚è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æœ‰æ¡ä»¶åœ°æ‰§è¡Œä¸€ä¸ª effectï¼Œå¯ä»¥å°†åˆ¤æ–­æ”¾åˆ° Hook çš„å†…éƒ¨
```jsx
useEffect(function persistForm() {
  // ğŸ‘ å°†æ¡ä»¶åˆ¤æ–­æ”¾ç½®åœ¨ effect ä¸­
  if (name !== '') {
    localStorage.setItem('formData', name);
  }
});
```

# 6. è‡ªå®šä¹‰ Hook

- é€šè¿‡è‡ªå®šä¹‰ Hookï¼Œå¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­
- ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ä¾‹å­
```jsx
import React, { useState, useEffect } from 'react';

const useCount = (initValue) => {

    const [count, setCount] = useState(initValue);

    // useCount æŠ½å–çš„å°±æ˜¯ effect éƒ¨åˆ†çš„é€»è¾‘ï¼Œæ¯ä¸ª count å€¼çš„å˜åŒ–éƒ½å°†å¯¼è‡´ title çš„åˆ·æ–°
    // æ³¨æ„åªæœ‰ count å˜åŒ–æ‰ä¼šå›è°ƒï¼Œå› æ­¤å•å‡»å“ªä¸ªæœ€ç»ˆ title å°±æ˜¯é‚£ä¸ªå€¼ï¼Œ
    // å¦‚æœä¸åŠ ç¬¬äºŒä¸ªå‚æ•° title å°†å§‹ç»ˆä¼šæ˜¯ count2 çš„å€¼
    useEffect(() => {
        console.log(count);
        document.title = `You clicked ${count} times`;
    }, [count]);

    return [count, setCount];
};


export default () => {
    // åˆ©ç”¨è‡ªå®šä¹‰ Hook å£°æ˜ä¸¤ä¸ª countï¼Œå¹¶ç»™å®šä¸åŒçš„åˆå§‹å€¼è¿›è¡Œè§‚å¯Ÿ
    const [count1, setCount1] = useCount(0);
    const [count2, setCount2] = useCount(10);

    return (
        <div>
            <p>You clicked {count1} times count1, {count2} times count2</p>
            <button onClick={() => setCount1(prevCount => prevCount + 1)}>
                count1
            </button> &nbsp;
            <button onClick={() => setCount2(prevCount => prevCount + 1)}>
                count2
            </button>
        </div>
    );
}
```

