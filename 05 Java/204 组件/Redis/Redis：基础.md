---
title: Redis 基础
categories:
  - Redis
date: 2020-09-17 22:10:52
---

# 概述

## 基础常识

- 2 个基础设施：冯诺依曼体系结构的硬件，以太网 + TCP/IP 的网络
- 现代架构的很多问题都是基于这两个基础设施而产生的，例如网络不稳定问题导致分布式下的数据不一致性、双写；磁盘 I/O 瓶颈导致的大数据慢查询，从而引出缓存
- 磁盘的寻址速度为 ms 级，带宽为 G 或 M 级别
- 内存的寻子速度为 ns 级，带宽很大，
- 秒 > 毫秒 > 微妙 > 纳秒，显然，磁盘的寻址速度比内存慢了 10 万倍
- 磁盘分为磁道和扇区，一个扇区为 512 Byte，但对磁盘的读写和划分不会基于这么小的一块区域，因为过小的区域划分会导致索引表变大的问题
- 现代 OS 基本采用 4K 对齐，根据局部性原理，为了加速读取，即无论你读多少，每次读取都从磁盘上取 4K 内容而不仅仅是一个扇区
- I/O 瓶颈：若数据存储在文件中，随着文件的变大，会受到硬盘瓶颈的影响，查询速度将越来越慢
- 数据库：
    - 每个 data page 定为 4K 大小
    - 索引用于加速查询
    - 关系数据库建表：必须给出 schema，多少列，类型（字节宽度），存储时倾向于行级存储
    - 表很大时，性能下降？如果有索引，增删改变慢；查询速度，若一个或少量查询，缓存命中，依然很快，当并发查询时，查询量很大，会受硬盘带宽影响
![mysql 瓶颈](https://raw.githubusercontent.com/h428/img/master/note/00000199.jpg)
- 大部分的关系型数据库都基于文件，例如 MySQL，其受磁盘 I/O 瓶颈的影响，此外还有基于内存的关系型数据库，例如 SAP HANA，但价格过于昂贵
- 为了解决基于文件的关系型的数据的大数据下的慢查询问题，提出了缓存技术，最常见的缓存技术有 memcached，redis，而我们的主题 Redis 就属于这一块内容
- [存储引擎](https://db-engines.com)，[redis](https://redis.io)，[redis-cn](http://www.redis.cn/)

## 底层原理



# 基本数据类型与使用场景

- string：字符串类型
    - 对于不需要额外操作或者只需要简单操作的缓存数据，可以序列化为 json 后存储，相当于模拟 session，甚至可以存储小文件（看做 bitmap）
    - 虽然是 string，但支持作为 int 进行 incr，因此可利用此生成主键、秒杀限流、计数等
    - 由于 string 支持 bit 运算，因此可利用 bit 运算完成一系列优化：
        - 统计任意时间窗口内，用户的登录次数
        - 统计区间内活跃用户数：将用户 id 映射成 [0, n) 然后各个位表示该用户在改天是否登录，每天只需一个变量就可以全部记录所有活跃用户，统计区间内的活跃用户则所有的区间内变量或即可
        - 权限设计：将权限抽象成 bit，然后用位运算判断是否拥有指定权限
        - 布隆过滤器以及其他二进制提升性能的场景
- list：链表
    - 数据共享，状态迁出，将共享的数据抽取到 redis 中，保持微服务的无状态
    - 模拟栈和队列，且自带串行，避免了程序锁，模拟个简单的消息队列
- hash：哈希表，可以将关联的数据组织成一个 hash，只使用一个 key 存储，避免 key 爆炸
    - 聚合场景：关于一个 entity 有多个维度信息，来自不同的表，聚合后可存储在 hash 中，例如商品详情页
    - 可以避免 key 爆炸增长，可以将关联的内容组织为一个 hash 存储于一个 key，大大减少 key 的数量（key 越多遍历成本越高）
- set：集合，去重且无序数据列表
    - 随机事件，随机抽取 set 中的数，例如抽奖
    - 简单推荐：相同的好友 - 交集，推荐好友 - 差集
- zset：有序集合
    - 有序事件
    - 排行榜
    - 评论 + 分页