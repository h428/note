# 环境搭建

## 基础环境

- 首先去 nodejs 官网安装最新的 nodejs 和 npm
- 镜像地址：旧镜像地址 `http://registry.npm.taobao.org` 将于 2022 年 5 月停止，新地址为 `https://registry.npmmirror.com`
- 换源与恢复：使用 `npm config set registry https://registry.npmmirror.com` 更换 npm 镜像源，可使用 `npm get registry` 查看是否更换成功；但换源后会影响模块发布，如果需要发布模块需要换回官方源 `npm config set registry https://registry.npmjs.org`
- 若不想换源，可以安装 cpmn 工具，然后使用 cnpm 替代 npm
- Windows 无法执行 yarn 脚本问题解决：

  - 搜索 powershell，右键以管理员身份运行
  - 输入：set-ExecutionPolicy RemoteSigned
  - 然后：输入 y

- 安装 yarn 和 tyarn：`npm i yarn tyarn -g`，其中 tyarn 类似 cnpm，是对 yarn 的封装，换成了淘宝源
- 也可以不用 tyarn，直接对 yarn 换源：和 npm 类似，使用 `yarn config get registry` 查看当前源，使用 `yarn config set registry https://registry.npmmirror.com` 切换源，原有的官方源为 `https://registry.yarnpkg.com`
- 此外，还可以使用 npm 和 yarn 的管理工具，分别为 nrm 和 yrm，它们可以快速切换 npm 和 yarn 的常用源，使用 `nrm/yrm ls` 查看所有源，带 `*` 的为当前在用的源，使用 `nrm/yrm use xxx` 切换到指定源，使用 `nrm/yrm test` 测试当前源的响应速度

## VS Code 环境搭建

要使用 VS Code 进行前端开发，必不可少地需要安装大量插件，主要包括：

- ESLint：语法校验
- Prettier - Code formatter：代码格式化
- Bracket Pair Colorizer：彩色括号即括号作用域
- Auto Rename Tag：自动更名对应的 tag
- HTML CSS Support：支持在 HTML 中写 CSS 的语法高亮
- Path Intellisense：URL 补全功能
- CSS Peak：使得在 HTML 和 JS 中可以通过 CSS 类型跳到对应文件
- Live Server：提供临时运行环境

安装插件后，还需要进行一些配置，主要配置保存时自动检查和格式化：

```json
{
  // 保存时执行 ESLint 检查
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  // 保存时执行代码格式化
  "editor.formatOnSave": true
}
```

### 微信小程序

需要安装如下插件：

- 小程序开发助手
- 小程序助手
- wxml
- minapp
- wechat-snippet

## WebStorm 环境搭建

作为 Java 程序员出身，相比标准前端开发工具 VS Code，个人更加习惯 WebStorm，故此处记录 WebStorm 如何搭建前端开发环境。

WebStorm 自身已经具备索引功能，且默认已经安装好 ESLint 和 Prettier 的插件，只需在创建新项目后启用即可。其中 ESLint 需要在 `Language & Frameworks -> JavaScript -> Code Quality Tool -> EsLint` 中启用插件。

最后，我们配置保存时自动格式化，打开 `Settings -> Tools -> Actions on Save`，勾选上 ESLint 插件和 Prettier 插件，这样只要按下 Ctrl + S 就会自动校验代码并格式化代码了

# 项目配置

## 安装脚手架

我们使用 vite 作为构建工具，基于 TS 和 React 作为搭建 demo。执行下列命令，使用 yarn 基于 Vite 提供的命令安装脚手架

```bash
yarn create vite
cd my-vite-app
yarn
yarn dev
```

## 配置 src 为 @

为了方便 IDE 识别 `@` 到 `src`，我们需要做如下的配置：

- 修改 vite.config.js，添加 `@` 相关配置内容，该配置主要在 Vite 构建时生效

```js
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": "/src",
    },
  },
});
```

- 同时为了方便 IDE 能识别 `@` 到指定路径，我们还需要修改 tsconfig.json 文件，主要添加下述内容：

```js
"compilerOptions": {
  "baseUrl": ".",
  "paths": {
    "@/*": [
      "src/*"
    ]
  }
}
```

## eslint 和 prettier

对于 ESLint 和 Prettier 部分，需要结合 IDE 的配置和项目的依赖及配置共同完成的。即需要在 IDE 安装并开启对应插件，同时项目引入对应依赖并编写响应配置，具体的插件安装请参考前面的环境搭建部分笔记，新建项目后启用插件即可。

已经安装了插件，项目要能够进行校验则需要安装 eslint 和 Prettier 相关依赖，执行下列命令安装依赖：

```bash
yarn add --dev eslint eslint-plugin-react eslint-plugin-import prettier eslint-plugin-prettier eslint-config-prettier prettier-eslint prettier-eslint-cli
```

上述依赖的具体作用大致如下：

- eslint：lint 代码的主要工具，一切校验都是基于此包
- @typescript-eslint/parser：Typescript 语法的解析器，类似于 babel-eslint 解析器一样，对应 parserOptions 的配置参考官方的 README
- eslint-plugin-react：React 专用的校验规则插件
- eslint-plugin-import：该插件想要支持对 ES2015+(ES6+) import/export 语法的校验，并防止一些文件路径拼错或者是导入名称错误的情况
- prettier：原始实现版本，定义了 prettier 规则并实现这些规则
- eslint-plugin-prettier：该插件辅助 Eslint 可以平滑地与 Prettier 一起协作，并将 Prettier 的解析作为 Eslint 的一部分，在最后的输出可以给出修改意见，这样当 Prettier 格式化代码的时候，依然能够遵循我们的 Eslint 规则
- eslint-config-prettier：将会禁用掉所有那些非必须或者和 prettier 冲突的规则，让您可以使用您最喜欢的 shareable 配置，而不让它的风格选择在使用 Prettier 时碍事。请注意该配置只是将规则 off 掉,所以它只有在和别的配置一起使用的时候才有意义
- prettier-eslint：输入代码，执行 prettier 后再 eslint --fix 输出格式化后的代码，仅支持字符串输入。
- prettier-eslint-cli：顾名思义，支持 CLI 命令执行 prettier-eslint 的操作

依赖安装完毕后，则需要为项目生成配置，可以执行 `npx eslint --init` 为项目生成 eslint 配置，其会生成 `.eslintrc.cjs`，由于我们引入了 prettier 以及一系列兼容 eslint 的插件，对于冲突的配置，不再需要再 eslint 的配置文件中配置，而是在 prettier 的配置文件中配置，本次配置如下

```js
module.exports = {
  root: true,
  parser: "@typescript-eslint/parser",
  parserOptions: {
    sourceType: "module",
    ecmaVersion: 11,
  },
  env: {
    browser: true,
    node: true,
    es6: true,
  },
  extends: [
    "eslint:recommended",
    "plugin:react/recommended",
    "plugin:@typescript-eslint/recommended",
  ],
  plugins: ["@typescript-eslint"],
  rules: {
    // 取消必须引入 React 的警告
    "react/react-in-jsx-scope": "off",
  },
};
```

对于 Prettier，则需要手动创建 `.prettierrc.cjs` 作为配置文件，文件用 module.exports = 输出，全部可选配置的详细解释可以参考[文档](https://prettier.io/docs/en/options.html)

```js
/**
 * prettier config
 * @ref https://prettier.io/
 * @desc generated at 9/15/2022, 12:51:48 PM
 */
module.exports = {
  useTabs: false,
  tabWidth: 2,
  singleQuote: false,
  htmlWhitespaceSensitivity: "css",
  endOfLine: "lf",
};
```

## EditorConfig

并不是所有的人都使用 VS code，所以为了在同样的项目下保持一致，比如 tab 的宽度或者行尾要不要有分号，对于 WebStorm 我们可以使用 .editorconfig 来统一这些配置。

```ini
# 该配置文件是给 webstorm 使用的
root = true

[*]
indent_style = space
indent_size = 2
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true
max_line_length = 100

[*.md]
trim_trailing_whitespace = false
```

# 参考连接

- [使用 VS Code 搭建一个很爽的前端环境, by Thomas Yang](https://medium.com/@thoamsy/%E4%BD%BF%E7%94%A8-vs-code-%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%BE%88%E7%88%BD%E7%9A%84%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83-2d393ba5cc45)
- [用 eslint 和 prettier 让跨 IDE 协作更舒服](https://ssshooter.com/2021-11-05-eslint-and-prettier2/)
- [使用 Vite 搭建 React 项目, by OlyLis](https://juejin.cn/post/7088243962967752711)
- [最全的 Eslint 配置模板，从此统一团队的编程习惯, by 小兀 666](https://juejin.cn/post/6844903859488292871)
